# Import necessary modules
require 'fileutils'

# Define function to get new image path
def get_new_image_path(filename)
  year = filename.split('-')[0]
  return "assets/images/#{year}/"
end

# Define function to move images to new directory
def move_images(old_path, new_path)
  Dir.glob("#{old_path}*").each do |file|
    FileUtils.mkdir_p(new_path) unless File.exist?(new_path)
    FileUtils.mv(file, new_path)
  end
end

# Define function to update image paths in a file
def update_image_paths(file, new_image_path)
  text = File.read(file)
  new_text = text.gsub(/media\//, new_image_path)
  File.open(file, "w") {|file| file.puts new_text }
end

# Iterate over all Markdown files in the directory
Dir.glob("content/posts/Legacy/*.md") do |file|
  new_image_path = get_new_image_path(File.basename(file, ".md"))
  move_images('media/', new_image_path)
  update_image_paths(file, new_image_path)
end